# name: test/sql/storage/attach_views.test
# description: Test attaching, creating and querying views
# group: [storage]

require postgres_scanner

require-env POSTGRES_TEST_DATABASE_AVAILABLE

statement ok
PRAGMA enable_verification

statement ok
ATTACH 'dbname=postgresscanner' AS s (TYPE POSTGRES)

statement ok
USE s;

statement ok
DROP VIEW IF EXISTS v5

statement ok
CREATE VIEW v5 AS SELECT 42 AS i;

query I
SELECT i FROM v5
----
42

statement error
CREATE VIEW v5 AS SELECT 84;
----
already exists

statement error
INSERT INTO v5 VALUES (42);
----
Catalog Error: v5 is not an table

# FIXME - error message here is not very descriptive
statement error
UPDATE v5 SET i=84
----

statement error
DELETE FROM v5
----

statement error
INSERT INTO v5 VALUES (1, 1);
----
Catalog Error: v5 is not an table

statement ok
CREATE VIEW IF NOT EXISTS v5 AS SELECT 84;

statement ok
CREATE OR REPLACE VIEW v5 AS SELECT 84;

query I
SELECT * FROM v5
----
84

statement error
DROP TABLE v5
----
not a table

statement ok
DROP VIEW v5

statement error
SELECT * FROM v5
----
Table with name v5 does not exist

statement error
DROP VIEW v5
----
View with name v5 does not exist

statement ok
CREATE VIEW v5(a) AS SELECT 99;

query I
SELECT a FROM v5
----
99

# special names
statement ok
CREATE OR REPLACE VIEW "table "" table '' table"("column "" column '' column") AS SELECT 3

query I
SELECT "column "" column '' column" FROM "table "" table '' table"
----
3
